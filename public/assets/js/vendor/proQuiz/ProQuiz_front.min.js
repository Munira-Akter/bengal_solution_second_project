"use strict";
!function(a,b){function c(){if(!f){f=!0;for(var a=0;a<e.length;a++)e[a].fn.call(window,e[a].ctx);e=[]}}function d(){"complete"===document.readyState&&c()}a=a||"wpProQuizReady",b=b||window;var e=[],f=!1,g=!1;b[a]=function(a,b){return f?void setTimeout(function(){a(b)},1):(e.push({fn:a,ctx:b}),void("complete"===document.readyState?setTimeout(c,1):g||(document.addEventListener?(document.addEventListener("DOMContentLoaded",c,!1),window.addEventListener("load",c,!1)):(document.attachEvent("onreadystatechange",d),window.attachEvent("onload",c)),g=!0)))}}("wpProQuizReady",window),wpProQuizReady(function(){for(var a=window.wpProQuizInitList||[],b=0;b<a.length;b++)jQuery(a[b].id).wpProQuizFront(a[b].init)}),function(a){var b={ajaxurl:"",loadData:"Loading",questionNotSolved:"You must answer this question.",questionsNotSolved:"You must answer all questions before you can completed the quiz.",fieldsNotFilled:"All fields have to be filled."};a.wpProQuizFront=function(c,d){function e(){var a=0,b=-1,c=0,d=!1;this.questionStart=function(c){-1!=b&&this.questionStop(),b=c,a=+new Date},this.questionStop=function(){-1!=b&&(i[b].time+=Math.round((new Date-a)/1e3),b=-1)},this.startQuiz=function(){d&&this.stopQuiz(),c=+new Date,d=!0},this.stopQuiz=function(){d&&(i.comp.quizTime+=Math.round((new Date-c)/1e3),d=!1)},this.init=function(){}}var f=a(c),g=d,h=this,i=new Object,j=new Object,k=0,l=null,m=[],n="",o=!1,p=1,q={randomAnswer:0,randomQuestion:0,disabledAnswerMark:0,checkBeforeStart:0,preview:0,cors:0,isAddAutomatic:0,quizSummeryHide:0,skipButton:0,reviewQustion:0,autoStart:0,forcingQuestionSolve:0,hideQuestionPositionOverview:0,formActivated:0,maxShowQuestion:0,sortCategories:0},r={isQuizStart:0,isLocked:0,loadLock:0,isPrerequisite:0,isUserStartLocked:0},s={check:'input[name="check"]',next:'input[name="next"]',questionList:".wpProQuiz_questionList",skip:'input[name="skip"]',singlePageLeft:'input[name="wpProQuiz_pageLeft"]',singlePageRight:'input[name="wpProQuiz_pageRight"]'},t={back:f.find('input[name="back"]'),next:f.find(s.next),quiz:f.find(".wpProQuiz_quiz"),questionList:f.find(".wpProQuiz_list"),results:f.find(".wpProQuiz_results"),quizStartPage:f.find(".wpProQuiz_text"),timelimit:f.find(".wpProQuiz_time_limit"),toplistShowInButton:f.find(".wpProQuiz_toplistShowInButton"),listItems:a()},u={token:"",isUser:0},v={START:0,END:1},w=function(){var a=g.timelimit,b=0,c={};return c.stop=function(){a&&(window.clearInterval(b),t.timelimit.hide())},c.start=function(){if(a){var d=1e3*a,e=t.timelimit.find("span").text(h.methode.parseTime(a)),f=t.timelimit.find(".wpProQuiz_progress");t.timelimit.show();var g=+new Date;b=window.setInterval(function(){var a=+new Date-g,b=d-a;a>=500&&e.text(h.methode.parseTime(Math.ceil(b/1e3))),f.css("width",b/d*100+"%"),0>=b&&(c.stop(),h.methode.finishQuiz(!0))},16)}},c}(),x=new function(){function b(a){var b=k.eq(a),c=b.offset().top,d=g.offset().top,e=c-d;if(0>e-4||e+32>100){var f=d-k.eq(0).offset().top-(d-j.offset().top)+b.position().top;f>p&&(f=p);var h=f/n;j.attr("style","margin-top: "+-f+"px !important"),i.css({top:h})}}function c(a){var b="",c=r[a];c.review?b="#FFB800":c.solved&&(b="#6CA54C"),k.eq(a).css("background-color",b)}function d(a){a.preventDefault();var b=a.pageY-m;0>b&&(b=0),b>l&&(b=l);var c=n*b;j.attr("style","margin-top: "+-c+"px !important"),i.css({top:b})}function e(b){b.preventDefault(),a(document).unbind(".scrollEvent")}var g=[],i=[],j=[],k=[],l=0,m=0,n=0,o=0,p=0,r=[];this.init=function(){g=f.find(".wpProQuiz_reviewQuestion"),i=g.find("div"),j=g.find("ol"),k=j.children(),i.mousedown(function(b){b.preventDefault(),b.stopPropagation(),m=b.pageY-i.offset().top+o,a(document).bind("mouseup.scrollEvent",e),a(document).bind("mousemove.scrollEvent",d)}),k.click(function(b){h.methode.showQuestion(a(this).index())}),f.bind("questionSolved",function(a){r[a.values.index].solved=a.values.solved,c(a.values.index)}),f.bind("changeQuestion",function(a){k.removeClass("wpProQuiz_reviewQuestionTarget"),k.eq(a.values.index).addClass("wpProQuiz_reviewQuestionTarget"),b(a.values.index)}),f.bind("reviewQuestion",function(a){r[a.values.index].review=!r[a.values.index].review,c(a.values.index)}),g.bind("mousewheel DOMMouseScroll",function(a){a.preventDefault();var b=a.originalEvent,c=b.wheelDelta?-b.wheelDelta/120:b.detail/3,d=20*c,e=o-j.offset().top+d;e>p&&(e=p),0>e&&(e=0);var f=e/n;return j.attr("style","margin-top: "+-e+"px !important"),i.css({top:f}),!1})},this.show=function(a){if(q.reviewQustion&&g.parent().show(),f.find(".wpProQuiz_reviewDiv .wpProQuiz_button2").show(),!a){j.attr("style","margin-top: 0px !important"),i.css({top:0});var b=j.outerHeight(),c=g.height();l=c-i.height(),m=0,p=b-c,n=p/l,this.reset(),b>100&&i.show(),o=i.offset().top}},this.hide=function(){g.parent().hide()},this.toggle=function(){if(q.reviewQustion){g.parent().toggle(),k.removeClass("wpProQuiz_reviewQuestionTarget"),f.find(".wpProQuiz_reviewDiv .wpProQuiz_button2").hide(),j.attr("style","margin-top: 0px !important"),i.css({top:0});var a=j.outerHeight(),b=g.height();l=b-i.height(),m=0,p=a-b,n=p/l,a>100&&i.show(),o=i.offset().top}},this.reset=function(){for(var a=0,b=k.length;b>a;a++)r[a]={};k.removeClass("wpProQuiz_reviewQuestionTarget").css("background-color","")}},y=new e,z=function(b,c,d,e){var f=!0,g=0,i=a.isArray(c.points),j={};return{singleMulti:function(){var b=e.find(".wpProQuiz_questionInput").attr("disabled","disabled"),d=c.diffMode;e.children().each(function(e){var j=a(this),k=j.data("pos"),l=b.eq(e).is(":checked");c.correct[k]?(l?i&&(d?g=c.points[k]:g+=c.points[k]):f=!1,c.disCorrect?f=!0:h.methode.marker(j,!0)):l?(c.disCorrect?f=!0:(h.methode.marker(j,!1),f=!1),d&&(g=c.points[k])):i&&!d&&(g+=c.points[k])})},sort_answer:function(){var b=e.children();b.each(function(b,d){var e=a(this);j[b]=e.data("pos"),b==e.data("pos")?(h.methode.marker(e,!0),i&&(g+=c.points[b])):(h.methode.marker(e,!1),f=!1)}),b.children().css({"box-shadow":"0 0",cursor:"auto"}),e.sortable("destroy"),b.sort(function(b,c){return a(b).data("pos")>a(c).data("pos")?1:-1}),e.append(b)},matrix_sort_answer:function(){var b=e.children(),k=new Array;j={0:-1},b.each(function(){var b=a(this),d=b.data("pos"),e=b.find(".wpProQuiz_maxtrixSortCriterion"),l=e.children();l.length&&(j[d]=l.data("pos")),l.length&&a.inArray(String(d),String(l.data("correct")).split(","))>=0?(h.methode.marker(e,!0),i&&(g+=c.points[d])):(f=!1,h.methode.marker(e,!1)),k[d]=e}),h.methode.resetMatrix(d),d.find(".wpProQuiz_sortStringItem").each(function(){var b=k[a(this).data("pos")];void 0!=b&&b.append(this)}).css({"box-shadow":"0 0",cursor:"auto"}),d.find(".wpProQuiz_sortStringList, .wpProQuiz_maxtrixSortCriterion").sortable("destroy")},free_answer:function(){var b=e.children(),d=b.find(".wpProQuiz_questionInput").attr("disabled","disabled").val();a.inArray(a.trim(d).toLowerCase(),c.correct)>=0?h.methode.marker(b,!0):(h.methode.marker(b,!1),f=!1)},cloze_answer:function(){e.find(".wpProQuiz_cloze").each(function(b,d){var e=a(this),j=e.children(),k=j.eq(0),l=j.eq(1),m=h.methode.cleanupCurlyQuotes(k.val());a.inArray(m,c.correct[b])>=0?(i&&(g+=c.points[b]),q.disabledAnswerMark||k.css("background-color","#B0DAB0")):(q.disabledAnswerMark||k.css("background-color","#FFBABA"),f=!1,l.show()),k.attr("disabled","disabled")})},assessment_answer:function(){f=!0;var b=e.find(".wpProQuiz_questionInput").attr("disabled","disabled"),c=0;b.filter(":checked").each(function(){c+=parseInt(a(this).val(),10)}),g=c}}[b](),!i&&f&&(g=c.points),{c:f,p:g,s:j}},A=new function(){var b={isEmpty:function(b){return!(b=a.trim(b))||0===b.length}},c={TEXT:0,TEXTAREA:1,NUMBER:2,CHECKBOX:3,EMAIL:4,YES_NO:5,DATE:6,SELECT:7,RADIO:8};this.checkForm=function(){var d=!0;return f.find(".wpProQuiz_forms input, .wpProQuiz_forms textarea, .wpProQuiz_forms .wpProQuiz_formFields, .wpProQuiz_forms select").each(function(){var e=a(this),f=1==e.data("required"),g=e.data("type"),h=!0,i=a.trim(e.val());switch(g){case c.TEXT:case c.TEXTAREA:case c.SELECT:f&&(h=!b.isEmpty(i));break;case c.NUMBER:(f||!b.isEmpty(i))&&(h=!b.isEmpty(i)&&!isNaN(i));break;case c.EMAIL:(f||!b.isEmpty(i))&&(h=!b.isEmpty(i)&&new RegExp(/^[a-z0-9!#$%&'*+\/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+\/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/).test(i));break;case c.CHECKBOX:f&&(h=e.is(":checked"));break;case c.YES_NO:case c.RADIO:f&&(h=void 0!==e.find('input[type="radio"]:checked').val());break;case c.DATE:var j=0,k=0;e.find("select").each(function(){j++,k+=b.isEmpty(a(this).val())?0:1}),(f||k>0)&&(h=j==k)}h?e.siblings(".wpProQuiz_invalidate").hide():(d=!1,e.siblings(".wpProQuiz_invalidate").show())}),d},this.getFormData=function(){var b={};return f.find(".wpProQuiz_forms input, .wpProQuiz_forms textarea, .wpProQuiz_forms .wpProQuiz_formFields, .wpProQuiz_forms select").each(function(){var d=a(this),e=d.data("form_id");switch(d.data("type")){case c.TEXT:case c.TEXTAREA:case c.SELECT:case c.NUMBER:case c.EMAIL:b[e]=d.val();break;case c.CHECKBOX:b[e]=d.is(":checked")?1:0;break;case c.YES_NO:case c.RADIO:b[e]=d.find('input[type="radio"]:checked').val();break;case c.DATE:b[e]={day:d.find('select[name="wpProQuiz_field_'+e+'_day"]').val(),month:d.find('select[name="wpProQuiz_field_'+e+'_month"]').val(),year:d.find('select[name="wpProQuiz_field_'+e+'_year"]').val()}}}),b}},B=function(b){f.find(".wpProQuiz_questionList").each(function(){var c=a(this),d=c.data("question_id"),e=c.data("type"),f={};if("single"==e||"multiple"==e)c.find(".wpProQuiz_questionListItem").each(function(){f[a(this).data("pos")]=+a(this).find(".wpProQuiz_questionInput").is(":checked")});else if("free_answer"==e)f[0]=c.find(".wpProQuiz_questionInput").val();else{if("sort_answer"==e)return!0;if("matrix_sort_answer"==e)return!0;if("cloze_answer"==e){var g=0;c.find(".wpProQuiz_cloze input").each(function(){f[g++]=a(this).val()})}else"assessment_answer"==e&&(f[0]="",c.find(".wpProQuiz_questionInput:checked").each(function(){f[a(this).data("index")]=a(this).val()}))}b[d].data=f})};h.methode={parseBitOptions:function(){if(g.bo){q.randomAnswer=1&g.bo,q.randomQuestion=2&g.bo,q.disabledAnswerMark=4&g.bo,q.checkBeforeStart=8&g.bo,q.preview=16&g.bo,q.isAddAutomatic=64&g.bo,q.reviewQustion=128&g.bo,q.quizSummeryHide=256&g.bo,q.skipButton=512&g.bo,q.autoStart=1024&g.bo,q.forcingQuestionSolve=2048&g.bo,q.hideQuestionPositionOverview=4096&g.bo,q.formActivated=8192&g.bo,q.maxShowQuestion=16384&g.bo,q.sortCategories=32768&g.bo;var a=32&g.bo;a&&void 0!=jQuery.support&&void 0!=jQuery.support.cors&&0==jQuery.support.cors&&(q.cors=a)}},setClozeStyle:function(){f.find(".wpProQuiz_cloze input").each(function(){for(var b=a(this),c="",d=b.data("wordlen"),e=0;d>e;e++)c+="w";var f=a(document.createElement("span")).css("visibility","hidden").text(c).appendTo(a("body")),g=f.width();f.remove(),b.width(g+5)})},parseTime:function(a){var b=parseInt(a%60,10),c=parseInt(a/60%60,10),d=parseInt(a/3600%24,10);return b=(b>9?"":"0")+b,c=(c>9?"":"0")+c,(d=(d>9?"":"0")+d)+":"+c+":"+b},cleanupCurlyQuotes:function(b){return b=b.replace(/\u2018/,"'"),b=b.replace(/\u2019/,"'"),b=b.replace(/\u201C/,'"'),b=b.replace(/\u201D/,'"'),a.trim(b).toLowerCase()},resetMatrix:function(b){b.each(function(){var b=a(this),c=b.find(".wpProQuiz_sortStringList");b.find(".wpProQuiz_sortStringItem").each(function(){c.append(a(this))})})},marker:function(a,b){q.disabledAnswerMark||(b?a.addClass("wpProQuiz_answerCorrect"):a.addClass("wpProQuiz_answerIncorrect"))},startQuiz:function(b){if(r.loadLock)return void(r.isQuizStart=1);if(r.isQuizStart=0,r.isLocked)return t.quizStartPage.hide(),void f.find(".wpProQuiz_lock").show();if(r.isPrerequisite)return t.quizStartPage.hide(),void f.find(".wpProQuiz_prerequisite").show();if(r.isUserStartLocked)return t.quizStartPage.hide(),void f.find(".wpProQuiz_startOnlyRegisteredUser").show();if(q.maxShowQuestion&&!b)return t.quizStartPage.hide(),f.find(".wpProQuiz_loadQuiz").show(),void h.methode.loadQuizDataAjax(!0);if(!q.formActivated||g.formPos!=v.START||A.checkForm()){switch(h.methode.loadQuizData(),q.randomQuestion&&h.methode.random(t.questionList),q.randomAnswer&&h.methode.random(f.find(s.questionList)),q.sortCategories&&h.methode.sortCategories(),h.methode.random(f.find(".wpProQuiz_sortStringList")),h.methode.random(f.find('[data-type="sort_answer"]')),f.find(".wpProQuiz_listItem").each(function(b,c){var d=a(this);d.find(".wpProQuiz_question_page span:eq(0)").text(b+1),d.find("> h5 span").text(b+1),d.find(".wpProQuiz_questionListItem").each(function(b,c){a(this).find("> span:not(.wpProQuiz_cloze)").text(b+1+". ")})}),t.next=f.find(s.next),g.mode){case 3:f.find('input[name="checkSingle"]').show();break;case 2:f.find(s.check).show(),!q.skipButton&&q.reviewQustion&&f.find(s.skip).show();break;case 1:f.find('input[name="back"]').slice(1).show();case 0:t.next.show()}(q.hideQuestionPositionOverview||3==g.mode)&&f.find(".wpProQuiz_question_page").hide();var c=t.next.last();n=c.val(),c.val(g.lbn);var e=t.questionList.children();if(t.listItems=f.find(".wpProQuiz_list > li"),3==g.mode)h.methode.showSinglePage(0);else{l=e.eq(0).show();var o=l.find(s.questionList).data("question_id");y.questionStart(o)}y.startQuiz(),f.find(".wpProQuiz_sortable").parents("ul").sortable({update:function(b,c){var d=a(this).parents(".wpProQuiz_listItem");f.trigger({type:"questionSolved",values:{item:d,index:d.index(),solved:!0}})}}).disableSelection(),f.find(".wpProQuiz_sortStringList, .wpProQuiz_maxtrixSortCriterion").sortable({connectWith:".wpProQuiz_maxtrixSortCriterion:not(:has(li)), .wpProQuiz_sortStringList",placeholder:"wpProQuiz_placehold",update:function(b,c){var d=a(this).parents(".wpProQuiz_listItem");f.trigger({type:"questionSolved",values:{item:d,index:d.index(),solved:!0}})}}).disableSelection(),m=[],w.start(),k=+new Date,i={comp:{points:0,correctQuestions:0,quizTime:0}},f.find(".wpProQuiz_questionList").each(function(){var b=a(this).data("question_id");i[b]={time:0,solved:0}}),j={},a.each(d.catPoints,function(a,b){j[a]=0}),t.quizStartPage.hide(),f.find(".wpProQuiz_loadQuiz").hide(),t.quiz.show(),x.show(),3!=g.mode&&f.trigger({type:"changeQuestion",values:{item:l,index:l.index()}})}},showSingleQuestion:function(a){var b=a?Math.ceil(a/g.qpp):1;this.showSinglePage(b)},showSinglePage:function(a){var b;if(b=t.questionList.children().hide(),!g.qpp)return void b.show();a=a?+a:1;var c=Math.ceil(f.find(".wpProQuiz_list > li").length/g.qpp);if(!(a>c)){var d=f.find(s.singlePageLeft).hide(),e=f.find(s.singlePageRight).hide(),i=f.find('input[name="checkSingle"]').hide();a>1&&d.val(d.data("text").replace(/%d/,a-1)).show(),a==c?i.show():e.val(e.data("text").replace(/%d/,a+1)).show(),p=a;var j=g.qpp*(a-1);b.slice(j,j+g.qpp).show(),h.methode.scrollTo(t.quiz)}},nextQuestion:function(){this.showQuestionObject(l.next())},prevQuestion:function(){this.showQuestionObject(l.prev())},showQuestion:function(a){var b=t.listItems.eq(a);return 3==g.mode||o?(g.qpp&&h.methode.showSingleQuestion(a+1),h.methode.scrollTo(b,1),void y.startQuiz()):void this.showQuestionObject(b)},showQuestionObject:function(a){if(!a.length&&q.forcingQuestionSolve&&q.quizSummeryHide&&q.reviewQustion)for(var c=0,d=f.find(".wpProQuiz_listItem").length;d>c;c++)if(!m[c])return alert(b.questionsNotSolved),!1;if(l.hide(),l=a.show(),h.methode.scrollTo(t.quiz),f.trigger({type:"changeQuestion",values:{item:l,index:l.index()}}),l.length){var e=l.find(s.questionList).data("question_id");y.questionStart(e)}else h.methode.showQuizSummary()},skipQuestion:function(){f.trigger({type:"skipQuestion",values:{item:l,index:l.index()}}),h.methode.nextQuestion()},reviewQuestion:function(){f.trigger({type:"reviewQuestion",values:{item:l,index:l.index()}})},showQuizSummary:function(){if(y.questionStop(),y.stopQuiz(),q.quizSummeryHide||!q.reviewQustion)return void(q.formActivated&&g.formPos==v.END?(x.hide(),t.quiz.hide(),h.methode.scrollTo(f.find(".wpProQuiz_infopage").show())):h.methode.finishQuiz());var b=f.find(".wpProQuiz_checkPage");b.find("ol:eq(0)").empty().append(f.find(".wpProQuiz_reviewQuestion ol li").clone().removeClass("wpProQuiz_reviewQuestionTarget")).children().click(function(c){b.hide(),t.quiz.show(),x.show(!0),h.methode.showQuestion(a(this).index())});for(var c=0,d=0,e=m.length;e>d;d++)m[d]&&c++;b.find("span:eq(0)").text(c),x.hide(),t.quiz.hide(),b.show(),h.methode.scrollTo(b)},finishQuiz:function(b){y.questionStop(),y.stopQuiz(),w.stop();var c=(+new Date-k)/1e3;c=g.timelimit&&c>g.timelimit?g.timelimit:c,f.find(".wpProQuiz_quiz_time span").text(h.methode.parseTime(c)),b&&t.results.find(".wpProQuiz_time_limit_expired").show(),h.methode.checkQuestion(t.questionList.children(),!0),f.find(".wpProQuiz_correct_answer").text(i.comp.correctQuestions),i.comp.result=Math.round(i.comp.points/g.globalPoints*100*100)/100,i.comp.solved=0;var d=f.find(".wpProQuiz_points span");d.eq(0).text(i.comp.points),d.eq(1).text(g.globalPoints),d.eq(2).text(i.comp.result+"%");var e=f.find(".wpProQuiz_resultsList > li").eq(h.methode.findResultIndex(i.comp.result)),j=A.getFormData();e.find(".wpProQuiz_resultForm").each(function(){var b=a(this),c=b.data("form_id"),d=j[c];"object"==typeof d&&(d=d.day+"-"+d.month+"-"+d.year),b.text(d).show()}),e.show(),h.methode.setAverageResult(i.comp.result,!1),this.setCategoryOverview(),h.methode.sendCompletedQuiz(),q.isAddAutomatic&&u.isUser&&h.methode.addToplist(),x.hide(),f.find(".wpProQuiz_checkPage, .wpProQuiz_infopage").hide(),t.quiz.hide(),t.results.show(),h.methode.scrollTo(t.results)},setCategoryOverview:function(){i.comp.cats={},f.find(".wpProQuiz_catOverview li").each(function(){var b=a(this),c=b.data("category_id");if(void 0===g.catPoints[c])return b.hide(),!0;var d=Math.round(j[c]/g.catPoints[c]*100*100)/100;i.comp.cats[c]=d,b.find(".wpProQuiz_catPercent").text(d+"%"),b.show()})},questionSolved:function(a){m[a.values.index]=a.values.solved;var b=a.values.item.find(s.questionList),c=g.json[b.data("question_id")];i[c.id].solved=Number(a.values.fake?i[c.id].solved:a.values.solved)},sendCompletedQuiz:function(){if(!q.preview){B(i);var a=A.getFormData();h.methode.ajax({action:"wp_pro_quiz_admin_ajax",func:"completedQuiz",data:{quizId:g.quizId,results:i,forms:a}})}},findResultIndex:function(a){for(var b=g.resultsGrade,c=-1,d=999999,e=0;e<b.length;e++){var f=b[e];a>=f&&d>a-f&&(d=a-f,c=e)}return c},showQustionList:function(){o=!o,t.toplistShowInButton.hide(),t.quiz.toggle(),f.find(".wpProQuiz_QuestionButton").hide(),t.questionList.children().show(),x.toggle(),f.find(".wpProQuiz_question_page").hide()},random:function(b){b.each(function(){var b=a(this).children().get().sort(function(){return Math.round(Math.random())-.5});a(b).appendTo(b[0].parentNode)})},sortCategories:function(){var b=a(".wpProQuiz_list").children().get().sort(function(b,c){var d=a(b).find(".wpProQuiz_questionList").data("question_id"),e=a(c).find(".wpProQuiz_questionList").data("question_id");return g.json[d].catId-g.json[e].catId});a(b).appendTo(b[0].parentNode)},restartQuiz:function(){t.results.hide(),t.quizStartPage.show(),t.questionList.children().hide(),t.toplistShowInButton.hide(),x.hide(),f.find(".wpProQuiz_questionInput, .wpProQuiz_cloze input").removeAttr("disabled").removeAttr("checked").css("background-color",""),f.find('.wpProQuiz_questionListItem input[type="text"]').val(""),f.find(".wpProQuiz_answerCorrect, .wpProQuiz_answerIncorrect").removeClass("wpProQuiz_answerCorrect wpProQuiz_answerIncorrect"),f.find(".wpProQuiz_listItem").data("check",!1),f.find(".wpProQuiz_response").hide().children().hide(),h.methode.resetMatrix(f.find(".wpProQuiz_listItem")),f.find(".wpProQuiz_sortStringItem, .wpProQuiz_sortable").removeAttr("style"),f.find(".wpProQuiz_clozeCorrect, .wpProQuiz_QuestionButton, .wpProQuiz_resultsList > li").hide(),f.find('.wpProQuiz_question_page, input[name="tip"]').show(),f.find(".wpProQuiz_resultForm").text("").hide(),t.results.find(".wpProQuiz_time_limit_expired").hide(),t.next.last().val(n),o=!1},checkQuestion:function(b,c){b=void 0==b?l:b,b.each(function(){var b=a(this),d=b.find(s.questionList),e=g.json[d.data("question_id")],h=e.type;if(y.questionStop(),b.data("check"))return!0;("single"==e.type||"multiple"==e.type)&&(h="singleMulti");var k=z(h,e,b,d);b.find(".wpProQuiz_response").show(),b.find(s.check).hide(),b.find(s.skip).hide(),b.find(s.next).show(),i[e.id].points=k.p,i[e.id].correct=Number(k.c),i[e.id].data=k.s,i.comp.points+=k.p,j[e.catId]+=k.p,k.c?(b.find(".wpProQuiz_correct").show(),i.comp.correctQuestions+=1):b.find(".wpProQuiz_incorrect").show(),b.find(".wpProQuiz_responsePoints").text(k.p),b.data("check",!0),c||f.trigger({type:"questionSolved",values:{item:b,index:b.index(),solved:!0,fake:!0}})})},showTip:function(){var b=a(this),c=b.siblings(".wpProQuiz_question").find(s.questionList).data("question_id");b.siblings(".wpProQuiz_tipp").toggle("fast"),i[c].tip=1,a(document).bind("mouseup.tipEvent",function(b){var c=f.find(".wpProQuiz_tipp"),d=f.find('input[name="tip"]');c.is(b.target)||0!=c.has(b.target).length||d.is(b.target)||(c.hide("fast"),a(document).unbind(".tipEvent"))})},ajax:function(c,d,e){e=e||"json",q.cors&&(jQuery.support.cors=!0),a.post(b.ajaxurl,c,d,e),q.cors&&(jQuery.support.cors=!1)},checkQuizLock:function(){r.loadLock=1,h.methode.ajax({action:"wp_pro_quiz_admin_ajax",func:"quizCheckLock",data:{quizId:g.quizId}},function(a){void 0!=a.lock&&(r.isLocked=a.lock.is,a.lock.pre&&f.find('input[name="restartQuiz"]').hide()),void 0!=a.prerequisite&&(r.isPrerequisite=1,f.find(".wpProQuiz_prerequisite span").text(a.prerequisite)),void 0!=a.startUserLock&&(r.isUserStartLocked=a.startUserLock),r.loadLock=0,r.isQuizStart&&h.methode.startQuiz()})},loadQuizData:function(){h.methode.ajax({action:"wp_pro_quiz_admin_ajax",func:"loadQuizData",data:{quizId:g.quizId}},function(a){a.toplist&&h.methode.handleToplistData(a.toplist),void 0!=a.averageResult&&h.methode.setAverageResult(a.averageResult,!0)})},setAverageResult:function(a,b){var c=f.find(".wpProQuiz_resultValue:eq("+(b?0:1)+") > * ");c.eq(1).text(a+"%"),c.eq(0).css("width",240*a/100+"px")},handleToplistData:function(a){var b=f.find(".wpProQuiz_addToplist"),c=b.find(".wpProQuiz_addBox").show().children("div");if(a.canAdd)if(b.show(),b.find(".wpProQuiz_addToplistMessage").hide(),b.find(".wpProQuiz_toplistButton").show(),u.token=a.token,u.isUser=0,a.userId)c.hide(),u.isUser=1,q.isAddAutomatic&&b.hide();else{c.show();var d=c.children().eq(1);a.captcha?(d.find('input[name="wpProQuiz_captchaPrefix"]').val(a.captcha.code),d.find(".wpProQuiz_captchaImg").attr("src",a.captcha.img),d.find('input[name="wpProQuiz_captcha"]').val(""),d.show()):d.hide()}else b.hide()},scrollTo:function(b,c){var d=b.offset().top-100;(c||(window.pageYOffset||document.body.scrollTop)>d)&&a("html,body").animate({scrollTop:d},300)},addToplist:function(){if(!q.preview){var a=f.find(".wpProQuiz_addToplistMessage").text(b.loadData).show(),c=f.find(".wpProQuiz_addBox").hide();h.methode.ajax({action:"wp_pro_quiz_admin_ajax",func:"addInToplist",data:{quizId:g.quizId,token:u.token,name:c.find('input[name="wpProQuiz_toplistName"]').val(),email:c.find('input[name="wpProQuiz_toplistEmail"]').val(),captcha:c.find('input[name="wpProQuiz_captcha"]').val(),prefix:c.find('input[name="wpProQuiz_captchaPrefix"]').val(),points:i.comp.points,totalPoints:g.globalPoints}},function(b){a.text(b.text),b.clear?(c.hide(),h.methode.updateToplist()):c.show(),b.captcha&&(c.find(".wpProQuiz_captchaImg").attr("src",b.captcha.img),c.find('input[name="wpProQuiz_captchaPrefix"]').val(b.captcha.code),c.find('input[name="wpProQuiz_captcha"]').val(""))})}},updateToplist:function(){"function"==typeof wpProQuiz_fetchToplist&&wpProQuiz_fetchToplist()},registerSolved:function(){f.find('.wpProQuiz_questionInput[type="text"]').change(function(b){var c=a(this),d=c.parents(".wpProQuiz_listItem"),e=!1;""!=c.val()&&(e=!0),f.trigger({type:"questionSolved",values:{item:d,index:d.index(),solved:e}})}),f.find('.wpProQuiz_questionList[data-type="single"] .wpProQuiz_questionInput, .wpProQuiz_questionList[data-type="assessment_answer"] .wpProQuiz_questionInput').change(function(b){var c=a(this),d=c.parents(".wpProQuiz_listItem"),e=this.checked;f.trigger({type:"questionSolved",values:{item:d,index:d.index(),solved:e}})}),f.find(".wpProQuiz_cloze input").change(function(){var b=a(this),c=b.parents(".wpProQuiz_listItem"),d=!0;c.find(".wpProQuiz_cloze input").each(function(){return""==a(this).val()?(d=!1,!1):void 0}),f.trigger({type:"questionSolved",values:{item:c,index:c.index(),solved:d}})}),f.find('.wpProQuiz_questionList[data-type="multiple"] .wpProQuiz_questionInput').change(function(b){var c=a(this),d=c.parents(".wpProQuiz_listItem"),e=0;d.find('.wpProQuiz_questionList[data-type="multiple"] .wpProQuiz_questionInput').each(function(a){this.checked&&e++}),f.trigger({type:"questionSolved",values:{item:d,index:d.index(),solved:!!e}})})},loadQuizDataAjax:function(b){h.methode.ajax({action:"wp_pro_quiz_admin_ajax",func:"quizLoadData",data:{quizId:g.quizId}},function(c){g.globalPoints=c.globalPoints,g.catPoints=c.catPoints,g.json=c.json,t.quiz.remove(),f.find(".wpProQuiz_quizAnker").after(c.content),t={back:f.find('input[name="back"]'),next:f.find(s.next),quiz:f.find(".wpProQuiz_quiz"),questionList:f.find(".wpProQuiz_list"),results:f.find(".wpProQuiz_results"),quizStartPage:f.find(".wpProQuiz_text"),timelimit:f.find(".wpProQuiz_time_limit"),toplistShowInButton:f.find(".wpProQuiz_toplistShowInButton"),listItems:a()},h.methode.initQuiz(),b&&h.methode.startQuiz(!0)})},initQuiz:function(){h.methode.setClozeStyle(),h.methode.registerSolved(),t.next.click(function(){return!q.forcingQuestionSolve||m[l.index()]||!q.quizSummeryHide&&q.reviewQustion?void h.methode.nextQuestion():(alert(b.questionNotSolved),!1)}),t.back.click(function(){h.methode.prevQuestion()}),f.find(s.check).click(function(){return!q.forcingQuestionSolve||m[l.index()]||!q.quizSummeryHide&&q.reviewQustion?void h.methode.checkQuestion():(alert(b.questionNotSolved),!1)}),f.find('input[name="checkSingle"]').click(function(){if(q.forcingQuestionSolve&&(q.quizSummeryHide||!q.reviewQustion))for(var a=0,c=f.find(".wpProQuiz_listItem").length;c>a;a++)if(!m[a])return alert(b.questionsNotSolved),!1;h.methode.showQuizSummary()}),f.find('input[name="tip"]').click(h.methode.showTip),f.find('input[name="skip"]').click(h.methode.skipQuestion),f.find('input[name="wpProQuiz_pageLeft"]').click(function(){h.methode.showSinglePage(p-1)}),f.find('input[name="wpProQuiz_pageRight"]').click(function(){h.methode.showSinglePage(p+1)})}},h.preInit=function(){h.methode.parseBitOptions(),x.init(),f.find('input[name="startQuiz"]').click(function(){return h.methode.startQuiz(),!1}),q.checkBeforeStart&&!q.preview&&h.methode.checkQuizLock(),f.find('input[name="reShowQuestion"]').click(function(){h.methode.showQustionList()}),f.find('input[name="restartQuiz"]').click(function(){h.methode.restartQuiz()}),f.find('input[name="review"]').click(h.methode.reviewQuestion),f.find('input[name="wpProQuiz_toplistAdd"]').click(h.methode.addToplist),f.find('input[name="quizSummary"]').click(h.methode.showQuizSummary),f.find('input[name="endQuizSummary"]').click(function(){if(q.forcingQuestionSolve)for(var a=0,c=f.find(".wpProQuiz_listItem").length;c>a;a++)if(!m[a])return alert(b.questionsNotSolved),!1;(!q.formActivated||g.formPos!=v.END||A.checkForm())&&h.methode.finishQuiz()}),f.find('input[name="endInfopage"]').click(function(){A.checkForm()&&h.methode.finishQuiz()}),f.find('input[name="showToplist"]').click(function(){t.quiz.hide(),t.toplistShowInButton.toggle()}),f.bind("questionSolved",h.methode.questionSolved),q.maxShowQuestion||h.methode.initQuiz(),q.autoStart&&h.methode.startQuiz()},h.preInit()},a.fn.wpProQuizFront=function(b){return this.each(function(){void 0==a(this).data("wpProQuizFront")&&a(this).data("wpProQuizFront",new a.wpProQuizFront(this,b))})}}(jQuery);